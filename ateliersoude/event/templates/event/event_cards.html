{% load thumbnail %}

{% for event in event_list %}
<div class="card infinite-item mb-4" data-location="{{event.location.pk|escape}}">
  <div class="card-header bg-primary"> 
    <span class="text-secondary">
      <i class="far fa-calendar-alt"></i>    
      {{ event.date|date:"l j F Y " }} <br>
      <span class="text-white">
        <i class="far fa-clock"></i>  
        {{ event.starts_at }} à {{ event.ends_at }}
      </span>
    </span>
    <div class="position-absolute" style="top: 10px; right:10px">
      {% if event.is_free %}
      <span class="text-success">Entrée libre</span>
      {% elif event.remaining_seats <= 0 %}
      <span class="text-danger">Complet</span>
      {% else %}
      <span
      class="
        {% if event.remaining_seats == event.available_seats %}
          text-success
        {% else %}
          text-warning
        {% endif %}
        ">
      <i class="fas fa-users"></i>    
        {{ event.remaining_seats}}
      </span>
      {% endif %}
    </div>
  </div>

  <a class="card-img-crop" href="{% url 'event:detail' event.pk event.slug %}">
      <span class="text-muted position-absolute" style="top:50px; right:0px">
        {% if request.user in event.registered.all or request.user in event.presents.all %}
          <span class="badge badge-success badge-pill">Inscrit</span>
          {% endif %}
          {% if request.user in event.organizers.all %}
          <span class="badge badge-success badge-pill">Organisateur</span>
          {% endif %}
      </span>
    {% if minimal != True and event.activity.picture %}
        {% thumbnail event.activity.picture "400" format="PNG" as im %}
          <img class="card-img-top rounded-0 event_img" src="{{ im.url }}"/>
        {% endthumbnail %}
    {% endif %}
    <div class="card-body p-0">
    <div class="p-2">
      <h5 class="">{{ event.activity.name }}</h5>
      <small class="text-muted">
        <i class="fa fa-map-marker-alt"></i>
        {{ event.location.name }}
      </small>
      <br>
      <small class="
        {% if event.needed_organizers != 0 %}
          {% if event.needed_organizers > event.organizers.all.count %}
            text-danger
          {% elif event.needed_organizers <= event.organizers.all.count %}
            text-success
          {% else %}
            text-warning
          {% endif %}
        {% endif %}"> 
        {% if event.needed_organizers != 0 %}
          {{ event.organizers.all.count }}/{{ event.needed_organizers }} animateurs
        {% endif %}
      </small>
      {% if minimal != True %}
      <hr>
      <small>
      {{ event.activity.description | safe | truncatewords_html:5 }}
      </small>
      {% endif %}
    </div>
      <div class="text-center">
        {% if event.organization.picture %}
        {% thumbnail event.organization.picture "30x30" crop="left" format="PNG" as im %}
          <img class="img-fluid rounded-circle square-2" src="{{ im.url }}" alt="organization img">
        {% endthumbnail %}
        {% endif %}
        <small>Organisé par {{ event.organization }}</small>
      </div>
    </a>
    <footer class="text-muted text-center">
      {% if not event.is_free %}
        {% if event.remaining_seats > 0 %}
          {% include "event/register.html" with event=event %}
        {% else %}
        <a class="btn btn-block btn-outline-danger"> Complet</a>
        {% endif %}
      {% else %}
        <a class="btn btn-block btn-outline-danger"> Sans réservation</a>
      {% endif %}
    </footer>
    </div>
</div>
{% endfor %}

