

{% load staticfiles %}
{% load fontawesome %}
{% load avatar_tags %}

{% block list %}
<div id="{{event.id}}" class="card card-event 
{% if event.available_seats <= 0 %}
    border border-danger
{% endif %}">
    <div class="event-card-title text-center row">

            {% if event.title %}
            {{event.title}}
            {% else %}
            <a class="col-lg" href="{% url 'event_detail' event.id event.slug %}">
            {{event.type}}</a>
            {% endif %}

            <div class="float-left mr-2">
            {% if event.available_seats == 0 %}
                <span class="badge badge-warning badge-pill">0</span>
            {% else %}
                <span class="badge badge-primary badge-pill">{{ event.available_seats }}</span>
            {% endif %}
                <small>Places</small>
            </div>

    </div>

    <div class="{{class}}">

        <div class="text-center align-middle {{img_class}}">
            <img class="img-fluid img-place" src="{{ event.type.picture.url }}">
        </div>

        <div class="{{about_class}} pl-1">
            <div class="">
        
            
            <!-- about -->

            <ul class="list-group list-group-flush">

                    <li class="">
                        <small>organisé par 
                            <a href="{% url 'organization_detail' event.organization.id event.organization.slug %}">
                            {{ event.organization }}
                        </a></small> 
                    </li>

                {% if request.resolver_match.url_name != "event_detail" %}

                    <li class="">
                        <!-- <small>{% fontawesome_icon 'clock-o' %} {{ event.starts_at }}</small> -->
                    </li>
                    <li>
                        {% for condition in event.condition.all %}
                        <a> <small>{{condition.resume}}</small> </a>
                        {% endfor %}
                    
                    </li>

                    <li class="">
                        de <span class="hour-event text-center">{{ event.starts_at|date:"H:i" }}</span>
                        à <span class="hour-event text-center">{{ event.ends_at|date:"H:i" }}</span>
                    </li>
                        <a href="{% url 'place_detail' event.location.id event.location.slug %}">
                            {% fontawesome_icon 'map-marker' %}
                            <small>{{ event.location|truncatechars:25 }}</small>
                        </a>
                    </li>

                </ul>
    
                <!-- book -->
            
                    {% if request.user.is_authenticated and event in my_events_attending %}
                    
                        <a class="card-link mr-3 fm-update btn btn-primary float-right" href="{% url 'booking_form' event.id %}"
                        data-fm-head="Update" data-fm-callback="reload">
                        {% fontawesome_icon 'delete' %}
                    Annuler
                    </a>

                    {% else %}

                        <a class="card-link mr-3 fm-update btn btn-primary float-right" href="{% url 'booking_form' event.id %}"
                        data-fm-head="Update" data-fm-callback="reload">  
                        {% fontawesome_icon 'ticket' %}
                        Réserver
                        </a>

                    {% endif %}
            
                
            
            <!-- delete if user is organizer -->

                {% if request.user.is_authenticated and event in my_events_organizing %}
                    <a href="#" class="card-link">Supprimer</a>
                    {% fontawesome_icon 'trash' large=True %}
                {% endif %}
            
            {% endif %}

        </div>

    </div>    
</div>
</div>

{% endblock list %}