{% extends 'detail_view.html' %}

{% load staticfiles %}
{% load fontawesome %}
{% load app_filters %}
{% load avatar_tags %}
{% load django_bootstrap_breadcrumbs %}
{% load django_markdown django_markdown_static %}
{% load easy_maps_tags %}

{% block breadcrumbs %}
{% with type="events" list_view="event_list" detail_name=event.title %}
   {{ block.super }}
{% endwith %}
{% endblock %}


{% block TitleAndEdit %}

<h5 class="float-left">
    {{ event.type }} du {{ event.starts_at|date:"d M" }} à
    <a href="{% url 'place_detail' event.location.id event.location.slug %}">
          {{ event.location.name }}
    </a>
</h5>

{% if not request.user.is_authenticated %}
{% else %}
    {% if request.user in event.organizers.all %}
        <a class="card-link mr-3 fm-update btn btn-primary float-right" href="{% url 'event_edit' event.id %}"
    data-fm-head="Update" data-fm-callback="reload">&nbsp
        <i class="fa fa-pencil-square-o 2-xs pt-1"></i>
        Editer
        </a>
    {% elif request.user in event.presents.all %}
    {% else %}
        <a class="card-link mr-3 fm-update btn btn-primary float-right" href="{% url 'booking_form' event.id %}"
        data-fm-head="Book" data-fm-callback="reload">&nbsp
        <i class="fa fa-pencil-square-o 2-xs pt-1"></i>
        {% if request.user in event.attendees.all %}
            Annuler Réservation
        {% else %}
            Réserver
        {% endif %}
        </a>
    {% endif %}
{% endif %}

{% endblock TitleAndEdit %}


{% block header_ban %}
    {% with object="event" %}
    {{ block.super }}
{% endwith %}

{% endblock header_ban %}


{% block context %}

    <div class="pt-3">
        {% include "plateformeweb/event.html" with img_class="row" about_class="row" %}
    </div>

    <div class="m-3 pt-3 p-2 bg-white">
            <p>
                {% for condition in event.condition.all %}
                    <span>
                    {{condition.resume}}
                    </span></br>
                {% endfor %}
            </p>
        </div>

    <div class="m-3 pt-3 p-2 bg-white">
        <p>
        {{event.type.description|truncatechars:100|markdown}}
        </p>
        <a href="{% url 'activity_detail' event.type.id event.type.slug %}">En savoir +</a>
    </div>

    <div class="m-3 pt-3 p-2 bg-white">
        <h6>
            {% fontawesome_icon 'map-marker' %}
            <a href="{% url 'place_detail' event.location.id event.location.slug %}">
                {{ event.location.name }}</a>,
            {{ event.location.address }}
        </h6>
        {% easy_map event.location.address 100 100 15 %}
    </div>

{% endblock context %}


{% block about %}

{% block about1 %}

    {% with about1="Animateur.trice.s" %}
    {{ block.super }}
    {% endwith %}
        {% for user in event.organizers.all %}
        {% include "users/user.html" with class="row" orga=True img_class="col-4" content_class="col-8" %}
        {% endfor %}

{% endblock about1 %}

{% block about2 %}

    {% with about2="Membres Actifs" %}
    {{ block.super }}
    {% endwith %}

    {% for user in volunteers %}
            {% include "users/user.html" with class="row" user_id=user.id img_class="col-12" content_class="col-12 text-center" absentee=True userid=user.id|serialize_id:event.id %}
    {% endfor %}

{% endblock about2 %}

{% block about3 %}

    {% with about3="Participant.e.s" %}
    {{ block.super }}
    {% endwith %}

    {% if request.user.is_authenticated and request.user in admin_or_volunteer %}
        {% for user in event.presents.all %}
            {% if user not in admin_or_volunteer %}
                {% include "users/user.html" with class="row border border-success checked" user_id=user.id img_class="col-12" content_class="col-12 text-center" absentee=False userid=user.id|serialize_id:event.id %}
            {% endif %}
        {% endfor %}
        {% for user in event.attendees.all %}
            {% if user not in admin_or_volunteer %}
                {% include "users/user.html" with class="row" user_id=user.id img_class="col-12" content_class="col-12 text-center" absentee=True userid=user.id|serialize_id:event.id %}
            {% endif %}
        {% endfor %}
    {% else %}
        Vous devez être membre actif pour voir les participant.e.s
    {% endif %}

{% endblock about3 %}

<script src="{% static "js/helper_functions.js" %}"></script>
<script src="{% static "js/event_detail.js" %}"></script>
{% endblock about %}

</section>
